<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Dashboard - AACEM Coaching</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="icon" href="logo.png" type="image/png">

  <style>
    :root {
      --primary: #2d6b6b;
      --primary-light: #3d8b8b;
      --primary-dark: #1d4b4b;
      --accent: #00b4d8;
      --accent-light: #0dcaf0;
      --sidebar-width: 280px;
      --header-height: 60px;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      overflow-x: hidden;
    }

    /* Header */
    .top-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: var(--header-height);
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 1000;
      display: flex;
      align-items: center;
      padding: 0 20px;
      color: white;
    }

    .toggle-btn {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
      margin-right: 15px;
    }

    .toggle-btn:hover {
      background: rgba(255,255,255,0.1);
    }

    .toggle-btn i {
      transition: transform 0.3s ease;
    }

    .toggle-btn.expanded i {
      transform: rotate(90deg);
    }

    .header-brand {
      display: flex;
      align-items: center;
      font-size: 1.3rem;
      font-weight: 600;
      flex: 1;
    }

    .header-brand i {
      color: var(--accent-light);
      margin-right: 10px;
      font-size: 1.5rem;
    }

    .header-user {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .welcome-text {
      font-size: 0.95rem;
      font-weight: 500;
    }

    .logout-btn {
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      color: white;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .logout-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-2px);
    }

    /* Custom Logout Modal */
    .logout-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }
    
    .logout-modal.show {
      display: flex;
    }
    
    .logout-box {
      background: white;
      padding: 40px;
      border-radius: 15px;
      text-align: center;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      animation: slideIn 0.3s ease;
    }

    .logout-box h4 {
      color: var(--primary);
      margin-bottom: 20px;
    }

    .logout-box i {
      font-size: 3rem;
      color: var(--accent);
      margin-bottom: 20px;
    }

    .logout-box p {
      color: #666;
      margin-bottom: 25px;
      font-size: 1.1rem;
    }

    .logout-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
    }

    .btn-logout {
      padding: 10px 30px;
      border-radius: 25px;
      font-weight: 600;
      border: none;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .btn-logout-confirm {
      background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      color: white;
    }

    .btn-logout-cancel {
      background: #6c757d;
      color: white;
    }

    .btn-logout:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    /* Sidebar - Default Collapsed */
    .sidebar {
      position: fixed;
      top: var(--header-height);
      left: 0;
      width: var(--sidebar-width);
      height: calc(100vh - var(--header-height));
      background: linear-gradient(180deg, #2c3e50 0%, #1a252f 100%);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 999;
      overflow-y: auto;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    }

    .sidebar.expanded {
      transform: translateX(0);
    }

    .sidebar-header {
      padding: 20px;
      background: rgba(0,0,0,0.2);
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .sidebar-header h4 {
      color: var(--accent-light);
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0;
    }

    .sidebar-menu {
      padding: 15px 10px;
    }

    .menu-item {
      display: flex;
      align-items: center;
      padding: 14px 20px;
      margin: 5px 0;
      color: #b8c5d6;
      text-decoration: none;
      border-radius: 10px;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .menu-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: var(--accent);
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }

    .menu-item:hover {
      background: rgba(255,255,255,0.05);
      color: white;
      padding-left: 24px;
    }

    .menu-item:hover::before {
      transform: scaleY(1);
    }

    .menu-item.active {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(0,180,216,0.3);
    }

    .menu-item.active::before {
      transform: scaleY(1);
    }

    .menu-item i {
      margin-right: 12px;
      font-size: 1.1rem;
      width: 25px;
      text-align: center;
    }

    .menu-item span {
      font-size: 0.95rem;
      font-weight: 500;
    }

    /* Main Content */
    .main-content {
      margin-left: 0;
      margin-top: var(--header-height);
      padding: 30px;
      min-height: calc(100vh - var(--header-height));
      transition: margin-left 0.3s ease;
    }

    .main-content.sidebar-expanded {
      margin-left: var(--sidebar-width);
    }

    /* Content Sections */
    .content-section {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .content-section.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Cards */
    .dashboard-card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 25px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
    }

    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
    }

    .card-header-custom {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }

    .card-header-custom h4 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--primary);
      display: flex;
      align-items: center;
    }

    .card-header-custom h4 i {
      font-size: 1.8rem;
      margin-right: 12px;
      color: var(--accent);
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      box-shadow: 0 5px 20px rgba(102,126,234,0.3);
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-card .number {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 8px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    .stat-card .label {
      font-size: 1rem;
      opacity: 0.95;
      font-weight: 500;
    }

    /* Loading */
    .loading-container {
      text-align: center;
      padding: 60px 20px;
    }

    .spinner-custom {
      width: 50px;
      height: 50px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Tables */
    .table-custom {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      width: 100%;
      margin-bottom: 0;
    }

    .table-custom thead {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
    }

    .table-custom thead th {
      border: none;
      padding: 15px;
      font-weight: 600;
      text-align: center;
      vertical-align: middle;
    }

    .table-custom tbody td {
      padding: 12px 15px;
      vertical-align: middle;
      border-top: 1px solid #dee2e6;
    }

    .table-custom tbody tr {
      transition: background 0.2s ease;
    }

    .table-custom tbody tr:hover {
      background: #f8f9fa;
    }

    /* Badges */
    .badge-custom {
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.85rem;
    }

    /* Progress Bar */
    .progress-custom {
      height: 30px;
      border-radius: 15px;
      background: #e9ecef;
      overflow: hidden;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
    }

    .progress-bar-custom {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.9rem;
      border-radius: 15px;
      transition: width 0.6s ease;
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent-light) 100%);
    }

    /* Buttons */
    .btn-custom {
      padding: 10px 25px;
      border-radius: 25px;
      font-weight: 600;
      border: none;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .btn-custom:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .btn-primary-custom {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      color: white;
    }

    /* Login Modal */
    .login-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }
    
    .login-modal.show {
      display: flex;
    }
    
    .login-box {
      background: white;
      padding: 50px;
      border-radius: 20px;
      text-align: center;
      max-width: 450px;
      width: 90%;
      box-shadow: 0 10px 50px rgba(0,0,0,0.3);
      animation: slideIn 0.4s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .login-box h3 {
      color: var(--primary);
      margin-bottom: 20px;
    }

    .login-box i {
      font-size: 3rem;
      margin-bottom: 20px;
    }

    /* Edit Profile Modal */
    .modal-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      border-radius: 15px 15px 0 0;
    }

    .form-control:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 0.2rem rgba(0, 180, 216, 0.25);
    }

    /* Profile Edit Section */
    .profile-edit-btn {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 20px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .profile-edit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,180,216,0.3);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
      }

      .sidebar.expanded {
        transform: translateX(0);
      }

      .main-content {
        padding: 20px;
      }

      .main-content.sidebar-expanded {
        margin-left: 0;
      }

      .welcome-text {
        display: none;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .table-custom {
        font-size: 0.9rem;
      }
      
      .table-custom thead th,
      .table-custom tbody td {
        padding: 10px 8px;
      }

      .logout-actions {
        flex-direction: column;
        width: 100%;
      }

      .btn-logout {
        width: 100%;
      }
    }

    /* Scrollbar */
    .sidebar::-webkit-scrollbar {
      width: 6px;
    }

    .sidebar::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.05);
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
    }

    .sidebar::-webkit-scrollbar-thumb:hover {
      background: rgba(255,255,255,0.3);
    }

    /* Alert Custom */
    .alert-custom {
      border-radius: 12px;
      border: none;
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .alert-custom i {
      font-size: 1.5rem;
    }

    /* Toggle Details Button */
    .toggle-details {
      cursor: pointer;
      color: var(--accent);
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      margin-top: 15px;
      padding: 10px 20px;
      border: 2px solid var(--accent);
      border-radius: 25px;
      transition: all 0.3s ease;
      background: white;
    }

    .toggle-details:hover {
      background: var(--accent);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,180,216,0.3);
    }

    .toggle-details i {
      margin-left: 8px;
      transition: transform 0.3s ease;
    }

    .toggle-details.active i {
      transform: rotate(180deg);
    }

    .details-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease;
    }

    .details-content.show {
      max-height: 2000px;
    }

    /* PDF Card */
    .pdf-card {
      border: 2px solid #e9ecef;
      border-radius: 12px;
      transition: all 0.3s ease;
      height: 100%;
    }

    .pdf-card:hover {
      border-color: var(--accent);
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,180,216,0.2);
    }

    .pdf-card .card-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-bottom: 2px solid #dee2e6;
    }
    
    /* Table Styling */
    .table-container {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      margin-bottom: 30px;
    }
    
    .table-title {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      padding: 15px 20px;
      font-size: 1.2rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .table-title i {
      font-size: 1.4rem;
    }
    
    /* PDF Preview Modal */
    .pdf-preview-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      z-index: 10000;
      justify-content: center;
      align-items: center;
    }
    
    .pdf-preview-modal.show {
      display: flex;
    }
    
    .pdf-preview-content {
      background: white;
      width: 95%;
      height: 95%;
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    
    .pdf-preview-header {
      background: var(--primary);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .pdf-preview-body {
      flex: 1;
      padding: 20px;
      overflow: auto;
    }
    
    .pdf-iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 8px;
    }
    
    /* Alternative PDF View */
    .pdf-alternative-view {
      text-align: center;
      padding: 40px 20px;
    }
    
    .pdf-alternative-view i {
      font-size: 4rem;
      color: #dc3545;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

  <!-- Logout Confirmation Modal -->
  <div id="logoutModal" class="logout-modal">
    <div class="logout-box">
      <i class="fas fa-sign-out-alt"></i>
      <h4>Confirm Logout</h4>
      <p>Are you sure you want to logout from the dashboard?</p>
      <div class="logout-actions">
        <button class="btn-logout btn-logout-confirm" onclick="confirmLogout()">
          <i class="fas fa-check me-2"></i>OK
        </button>
        <button class="btn-logout btn-logout-cancel" onclick="cancelLogout()">
          <i class="fas fa-times me-2"></i>Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" class="login-modal">
    <div class="login-box">
      <i class="fas fa-lock text-danger"></i>
      <h3>Authentication Required</h3>
      <p class="mb-4">Please login to access the student dashboard</p>
      <button class="btn btn-primary-custom btn-lg" onclick="redirectToLogin()">
        <i class="fas fa-sign-in-alt me-2"></i>Go to Login Page
      </button>
    </div>
  </div>

  

  <!-- PDF Preview Modal -->
  <div id="pdfPreviewModal" class="pdf-preview-modal">
    <div class="pdf-preview-content">
      <div class="pdf-preview-header">
        <h5 class="mb-0" id="pdfPreviewTitle">PDF Preview</h5>
        <div>
          <button class="btn btn-sm btn-light me-2" onclick="downloadCurrentPdf()">
            <i class="fas fa-download me-1"></i> Download
          </button>
          <button class="btn btn-sm btn-light" onclick="closePdfPreview()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      <div class="pdf-preview-body">
        <div id="pdfViewerContainer">
          <iframe id="pdfViewer" class="pdf-iframe" src=""></iframe>
        </div>
        <div id="pdfAlternativeView" class="pdf-alternative-view" style="display: none;">
          <i class="fas fa-exclamation-triangle"></i>
          <h4>Unable to Load PDF</h4>
          <p class="text-muted mb-3">The PDF cannot be loaded directly due to server restrictions.</p>
          <button class="btn btn-primary-custom" onclick="downloadCurrentPdf()">
            <i class="fas fa-download me-2"></i>Download Instead
          </button>
          <p class="text-muted mt-3 small">If download doesn't work, contact your administrator.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header class="top-header">
    <button class="toggle-btn" onclick="toggleSidebar()">
      <i class="fas fa-bars"></i>
    </button>
    <div class="header-brand">
      <i class="fas fa-graduation-cap"></i>
      <span>AACEM Institute</span>
    </div>
    <div class="header-user">
      <span class="welcome-text" id="welcomeText">Welcome, Student</span>
      <button class="logout-btn" onclick="showLogoutConfirmation()">
        <i class="fas fa-sign-out-alt me-1"></i> Logout
      </button>
    </div>
  </header>

  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h4><i class="fas fa-tachometer-alt me-2"></i>Student Dashboard</h4>
    </div>
    <div class="sidebar-menu">
      <a class="menu-item active" onclick="showSection('profile')">
        <i class="fas fa-user"></i>
        <span>Profile</span>
      </a>
      <a class="menu-item" onclick="showSection('attendance')">
        <i class="fas fa-chart-bar"></i>
        <span>Attendance</span>
      </a>
      <a class="menu-item" onclick="showSection('timetable')">
        <i class="fas fa-calendar-alt"></i>
        <span>Timetable</span>
      </a>
      <a class="menu-item" onclick="showSection('study-materials')">
        <i class="fas fa-file-pdf"></i>
        <span>Study Materials</span>
      </a>
      <a class="menu-item" onclick="showSection('syllabus')">
        <i class="fas fa-book-open"></i>
        <span>Course Syllabus</span>
      </a>
      <a class="menu-item" onclick="showSection('results')">
        <i class="fas fa-file-alt"></i>
        <span>Results</span>
      </a>
      <a class="menu-item" onclick="showSection('fees')">
        <i class="fas fa-money-bill-wave"></i>
        <span>Fees</span>
      </a>
      <a class="menu-item" onclick="showSection('notice')">
        <i class="fas fa-bullhorn"></i>
        <span>Notices</span>
      </a>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content" id="mainContent">
    
    <!-- Profile Section -->
    <section id="profile" class="content-section active">
      <div class="dashboard-card">
        <div class="card-header-custom">
          <h4>
            <i class="fas fa-user"></i>
            My Profile
          </h4>
          
        </div>
        <div id="profileContent" class="loading-container">
          <div class="spinner-custom"></div>
          <p class="text-muted">Loading profile data...</p>
        </div>
      </div>
    </section>

    <!-- Attendance Section -->
    <section id="attendance" class="content-section">
      <div class="dashboard-card">
        <div class="card-header-custom">
          <h4>
            <i class="fas fa-chart-bar"></i>
            Attendance
          </h4>
        </div>
        <div id="attendanceContent" class="loading-container">
          <div class="spinner-custom"></div>
          <p class="text-muted">Loading attendance data...</p>
        </div>
      </div>
    </section>

    <!-- Timetable Section -->
    <section id="timetable" class="content-section">
      <div class="dashboard-card">
        <div class="card-header-custom">
          <h4>
            <i class="fas fa-calendar-alt"></i>
            Timetable
          </h4>
        </div>
        <div id="timetableContent" class="loading-container">
          <div class="spinner-custom"></div>
          <p class="text-muted">Loading timetable...</p>
        </div>
      </div>
    </section>

    <!-- Study Materials Section -->
    <section id="study-materials" class="content-section">
      <div class="dashboard-card">
        <div class="card-header-custom">
          <h4>
            <i class="fas fa-file-pdf"></i>
            Study Materials
          </h4>
        </div>
        <div id="pdfsContent" class="loading-container">
          <div class="spinner-custom"></div>
          <p class="text-muted">Loading study materials...</p>
        </div>
      </div>
    </section>

    <!-- Syllabus Section -->
    <section id="syllabus" class="content-section">
      <div class="dashboard-card">
        <div class="card-header-custom">
          <h4>
            <i class="fas fa-book-open"></i>
            Course Syllabus
          </h4>
        </div>
        <div id="syllabusContent" class="loading-container">
          <div class="spinner-custom"></div>
          <p class="text-muted">Loading course syllabus...</p>
        </div>
      </div>
    </section>

    <!-- Results Section -->
    <section id="results" class="content-section">
      <div class="dashboard-card">
        <div class="card-header-custom">
          <h4>
            <i class="fas fa-file-alt"></i>
            Results
          </h4>
        </div>
        <div id="resultsContent" class="loading-container">
          <div class="spinner-custom"></div>
          <p class="text-muted">Loading results...</p>
        </div>
      </div>
    </section>

    <!-- Fees Section -->
    <section id="fees" class="content-section">
      <div class="dashboard-card">
        <div class="card-header-custom">
          <h4>
            <i class="fas fa-money-bill-wave"></i>
            Fees
          </h4>
        </div>
        <div id="feesContent" class="loading-container">
          <div class="spinner-custom"></div>
          <p class="text-muted">Loading fee details...</p>
        </div>
      </div>
    </section>

    <!-- Notices Section -->
    <section id="notice" class="content-section">
      <div class="dashboard-card">
        <div class="card-header-custom">
          <h4>
            <i class="fas fa-bullhorn"></i>
            Notice Board
          </h4>
        </div>
        <div id="noticesContent" class="loading-container">
          <div class="spinner-custom"></div>
          <p class="text-muted">Loading notices...</p>
        </div>
      </div>
    </section>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // API Configuration
    const API_BASE_URL = 'https://aacem-backend.onrender.com/api';
    
    // Session timeout configuration (30 minutes)
    const SESSION_TIMEOUT = 30 * 60 * 1000;
    let sessionTimer;
    
    // Current PDF tracking
    let currentPdfId = null;
    let currentPdfTitle = null;
    let currentPdfUrl = null;

    // Back button handling
    let backButtonPressed = false;
    let backButtonTimer = null;

    // Current student data
    let currentStudentData = null;

    // Initialize back button listener
    function initBackButtonHandler() {
      if (window.history && window.history.pushState) {
        window.history.pushState(null, null, window.location.href);
        
        window.addEventListener('popstate', function(event) {
          if (!backButtonPressed) {
            backButtonPressed = true;
            showLogoutConfirmation();
            
            if (backButtonTimer) clearTimeout(backButtonTimer);
            backButtonTimer = setTimeout(() => {
              backButtonPressed = false;
            }, 3000);
          }
          
          window.history.pushState(null, null, window.location.href);
        });
      }
    }

    // Sidebar Toggle
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const mainContent = document.getElementById('mainContent');
      const toggleBtn = document.querySelector('.toggle-btn');
      
      sidebar.classList.toggle('expanded');
      mainContent.classList.toggle('sidebar-expanded');
      toggleBtn.classList.toggle('expanded');
    }

    // Show Section
    function showSection(sectionId) {
      const sections = document.querySelectorAll('.content-section');
      sections.forEach(section => section.classList.remove('active'));
      
      const selectedSection = document.getElementById(sectionId);
      if (selectedSection) {
        selectedSection.classList.add('active');
      }
      
      const menuItems = document.querySelectorAll('.menu-item');
      menuItems.forEach(item => item.classList.remove('active'));
      event.currentTarget.classList.add('active');
      
      if (window.innerWidth <= 768) {
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const toggleBtn = document.querySelector('.toggle-btn');
        
        if (sidebar.classList.contains('expanded')) {
          sidebar.classList.remove('expanded');
          mainContent.classList.remove('sidebar-expanded');
          toggleBtn.classList.remove('expanded');
        }
      }
    }

    // Check authentication
    function checkAuthentication() {
      const studentData = sessionStorage.getItem('studentData');
      
      if (!studentData) {
        document.getElementById('loginModal').classList.add('show');
        return null;
      }
      
      try {
        return JSON.parse(studentData);
      } catch (e) {
        document.getElementById('loginModal').classList.add('show');
        return null;
      }
    }

    // Redirect to login page
    function redirectToLogin() {
      window.location.href = 'student-login.html';
    }

    // Get student data
    const studentData = checkAuthentication();
    const STUDENT_ID = studentData ? studentData.student_id : null;

    // Check session timeout
    function checkSessionTimeout() {
      if (!studentData) return false;
      
      const loginTime = sessionStorage.getItem('loginTime');
      if (!loginTime) return false;

      const currentTime = new Date().getTime();
      const sessionStartTime = parseInt(loginTime);

      return currentTime - sessionStartTime <= SESSION_TIMEOUT;
    }

    // Logout due to timeout
    function logoutDueToTimeout() {
      sessionStorage.removeItem('studentToken');
      sessionStorage.removeItem('studentData');
      sessionStorage.removeItem('loginTime');
      
      document.getElementById('loginModal').classList.add('show');
    }

    // Start session timer
    function startSessionTimer() {
      if (sessionTimer) {
        clearTimeout(sessionTimer);
      }
      
      sessionTimer = setTimeout(logoutDueToTimeout, SESSION_TIMEOUT);
      
      const resetTimer = () => {
        if (sessionTimer) {
          clearTimeout(sessionTimer);
        }
        sessionTimer = setTimeout(logoutDueToTimeout, SESSION_TIMEOUT);
      };

      const events = ['mousedown', 'mousemove', 'keypress', 'click', 'scroll', 'touchstart'];
      events.forEach(event => {
        document.addEventListener(event, resetTimer, false);
      });
    }

    // Show logout confirmation modal
    function showLogoutConfirmation() {
      document.getElementById('logoutModal').classList.add('show');
    }

    // Cancel logout
    function cancelLogout() {
      document.getElementById('logoutModal').classList.remove('show');
      backButtonPressed = false;
    }

    // Confirm logout
    function confirmLogout() {
      sessionStorage.removeItem('studentToken');
      sessionStorage.removeItem('studentData');
      sessionStorage.removeItem('loginTime');
      
      clearTimeout(sessionTimer);
      
      document.getElementById('logoutModal').classList.remove('show');
      
      alert("You have been logged out!");
      window.location.href = "index.html";
    }

    // Main initialization
    document.addEventListener('DOMContentLoaded', async function() {
      if (!studentData || !checkSessionTimeout()) {
        document.getElementById('loginModal').classList.add('show');
        return;
      }
      
      document.getElementById('loginModal').classList.remove('show');
      startSessionTimer();
      
      console.log('Loading student dashboard data for:', STUDENT_ID);
      updateWelcomeMessage();
      loadStudentData();
      
      initBackButtonHandler();
    });

    // Update welcome message
    function updateWelcomeMessage() {
      if (studentData && studentData.name) {
        document.getElementById('welcomeText').textContent = `Welcome, ${studentData.name}`;
      }
    }

    // Load all student data
    async function loadStudentData() {
      try {
        await Promise.all([
          loadProfile(),
          loadAttendance(),
          loadResults(),
          loadFees(),
          loadNotices(),
          loadStudyMaterials(),
          loadSyllabus() 
        ]);
        
        await loadTimetable();
        
        console.log('All student data loaded successfully');
        
      } catch (error) {
        console.error('Error loading student data:', error);
      }
    }

    // Load Profile Data
    async function loadProfile() {
      try {
        const response = await fetch(`${API_BASE_URL}/student-profile/${STUDENT_ID}`);
        const result = await response.json();
        
        if (result.success && result.student) {
          const student = result.student;
          currentStudentData = student; // Store for editing
          
          document.getElementById('profileContent').innerHTML = `
            <div class="row g-4">
              <div class="col-md-6">
                <div class="border-start border-4 border-primary ps-3 mb-3">
                  <label class="text-muted small mb-1">Full Name</label>
                  <h6 class="mb-0">${student.name}</h6>
                </div>
                <div class="border-start border-4 border-primary ps-3 mb-3">
                  <label class="text-muted small mb-1">Student ID</label>
                  <h6 class="mb-0">${student.student_id}</h6>
                </div>
                <div class="border-start border-4 border-primary ps-3 mb-3">
                  <label class="text-muted small mb-1">Course</label>
                  <h6 class="mb-0">${student.course}</h6>
                </div>
                <div class="border-start border-4 border-primary ps-3 mb-3">
                  <label class="text-muted small mb-1">Parent Name</label>
                  <h6 class="mb-0">${student.parent_name || 'N/A'}</h6>
                </div>
              </div>
              <div class="col-md-6">
                <div class="border-start border-4 border-info ps-3 mb-3">
                  <label class="text-muted small mb-1">Admission Date</label>
                  <h6 class="mb-0">${student.join_date}</h6>
                </div>
                <div class="border-start border-4 border-info ps-3 mb-3">
                  <label class="text-muted small mb-1">Phone</label>
                  <h6 class="mb-0">${student.phone}</h6>
                </div>
                <div class="border-start border-4 border-info ps-3 mb-3">
                  <label class="text-muted small mb-1">Email</label>
                  <h6 class="mb-0">${student.email || 'N/A'}</h6>
                </div>
                <div class="border-start border-4 border-info ps-3 mb-3">
                  <label class="text-muted small mb-1">Fee Status</label>
                  <h6 class="mb-0">
                    <span class="badge badge-custom bg-${getFeeStatusColor(student.fee_status)}">
                      ${student.fee_status}
                    </span>
                  </h6>
                </div>
              </div>
            </div>
            ${student.address ? `
              <div class="mt-4 p-3 bg-light rounded">
                <label class="text-muted small mb-2"><i class="fas fa-map-marker-alt me-2"></i>Address</label>
                <p class="mb-0">${student.address}</p>
              </div>
            ` : ''}
            ${student.emergency_contact ? `
              <div class="mt-3 p-3 bg-light rounded">
                <label class="text-muted small mb-2"><i class="fas fa-phone-alt me-2"></i>Emergency Contact</label>
                <p class="mb-0">${student.emergency_contact}</p>
              </div>
            ` : ''}
          `;
        } else {
          document.getElementById('profileContent').innerHTML = `
            <div class="alert alert-custom alert-warning">
              <i class="fas fa-exclamation-triangle"></i>
              <span>Profile data not available</span>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error loading profile:', error);
        document.getElementById('profileContent').innerHTML = `
          <div class="alert alert-custom alert-danger">
            <i class="fas fa-exclamation-circle"></i>
            <span>Failed to load profile data</span>
          </div>
        `;
      }
    }

    // Load Attendance Data
    async function loadAttendance() {
      try {
        const response = await fetch(`${API_BASE_URL}/student-attendance/${STUDENT_ID}`);
        const result = await response.json();
        
        if (result.success && result.attendance) {
          const attendance = result.attendance;
          
          document.getElementById('attendanceContent').innerHTML = `
            <div class="stats-grid">
              <div class="stat-card">
                <div class="number">${attendance.percentage}%</div>
                <div class="label">Overall Attendance</div>
              </div>
              <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <div class="number">${attendance.present_days}</div>
                <div class="label">Present Days</div>
              </div>
              <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <div class="number">${attendance.total_days}</div>
                <div class="label">Total Days</div>
              </div>
            </div>
            
            <div class="mb-4">
              <label class="fw-bold mb-2">Attendance Progress</label>
              <div class="progress-custom">
                <div class="progress-bar-custom ${attendance.percentage >= 75 ? '' : 'bg-warning'}" 
                  style="width: ${attendance.percentage}%">
                  ${attendance.percentage}%
                </div>
              </div>
            </div>
            
            <div class="row text-center g-3 mb-4">
              <div class="col-4">
                <div class="p-3 bg-light rounded">
                  <h4 class="text-success mb-1">${attendance.present_days}</h4>
                  <small class="text-muted">Present</small>
                </div>
              </div>
              <div class="col-4">
                <div class="p-3 bg-light rounded">
                  <h4 class="text-danger mb-1">${attendance.absent_days}</h4>
                  <small class="text-muted">Absent</small>
                </div>
              </div>
              <div class="col-4">
                <div class="p-3 bg-light rounded">
                  <h4 class="text-primary mb-1">${attendance.total_days}</h4>
                  <small class="text-muted">Total</small>
                </div>
              </div>
            </div>
            
            <div class="toggle-details" onclick="toggleAttendanceDetails()">
              View Detailed Attendance
              <i class="fas fa-chevron-down"></i>
            </div>
            
            <div class="details-content mt-3" id="attendanceDetails">
              <div class="loading-container">
                <p class="text-muted">Click above to load detailed attendance...</p>
              </div>
            </div>
          `;
        } else {
          document.getElementById('attendanceContent').innerHTML = `
            <div class="alert alert-custom alert-warning">
              <i class="fas fa-exclamation-triangle"></i>
              <span>Attendance data not available</span>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error loading attendance:', error);
        document.getElementById('attendanceContent').innerHTML = `
          <div class="alert alert-custom alert-danger">
            <i class="fas fa-exclamation-circle"></i>
            <span>Failed to load attendance data</span>
          </div>
        `;
      }
    }

    // Toggle attendance details
    async function toggleAttendanceDetails() {
      const toggle = event.currentTarget;
      const details = document.getElementById('attendanceDetails');
      
      toggle.classList.toggle('active');
      
      if (toggle.classList.contains('active')) {
        details.classList.add('show');
        await loadDetailedAttendance();
      } else {
        details.classList.remove('show');
      }
    }

    // Load detailed attendance
    async function loadDetailedAttendance() {
      try {
        const response = await fetch(`${API_BASE_URL}/student-attendance-details/${STUDENT_ID}`);
        const result = await response.json();
        
        if (result.success && result.attendance_details && result.attendance_details.length > 0) {
          const attendanceDetails = result.attendance_details;
          
          let tableHTML = `
            <div class="table-container mt-3">
              <div class="table-title">
                <i class="fas fa-calendar-check"></i>
                <span>Detailed Attendance Records</span>
              </div>
              <div class="table-responsive">
                <table class="table table-custom">
                  <thead>
                    <tr>
                      <th width="15%">Date</th>
                      <th width="15%">Day</th>
                      <th width="20%">Class</th>
                      <th width="15%">Status</th>
                      <th width="35%">Remarks</th>
                    </tr>
                  </thead>
                  <tbody>
          `;
          
          attendanceDetails.forEach(item => {
            const date = new Date(item.date);
            const formattedDate = date.toLocaleDateString('en-IN', {
              day: '2-digit',
              month: '2-digit', 
              year: 'numeric'
            });
            
            const dayName = date.toLocaleDateString('en-IN', { weekday: 'long' });
            
            tableHTML += `
              <tr>
                <td>${formattedDate}</td>
                <td>${dayName}</td>
                <td>${item.class || 'N/A'}</td>
                <td>
                  <span class="badge badge-custom bg-${item.status === 'Present' ? 'success' : 'danger'}">
                    ${item.status}
                  </span>
                </td>
                <td>${item.remarks || '-'}</td>
              </tr>
            `;
          });
          
          tableHTML += `</tbody></table></div></div>`;
          
          document.getElementById('attendanceDetails').innerHTML = tableHTML;
        } else {
          document.getElementById('attendanceDetails').innerHTML = `
            <div class="alert alert-custom alert-info mt-3">
              <i class="fas fa-info-circle"></i>
              <span>No attendance records found</span>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error loading detailed attendance:', error);
        document.getElementById('attendanceDetails').innerHTML = `
          <div class="alert alert-custom alert-danger mt-3">
            <i class="fas fa-exclamation-circle"></i>
            <span>Failed to load attendance details</span>
          </div>
        `;
      }
    }

    // Load Study Materials
    async function loadStudyMaterials() {
      try {
        const profileResponse = await fetch(`${API_BASE_URL}/student-profile/${STUDENT_ID}`);
        const profileResult = await profileResponse.json();
        
        if (!profileResult.success || !profileResult.student) {
          throw new Error('Unable to fetch student profile');
        }
        
        const student = profileResult.student;
        
        const response = await fetch(`${API_BASE_URL}/course-pdfs?course=${encodeURIComponent(student.course)}`);
        const result = await response.json();
        
        if (result.success && result.pdfs && result.pdfs.length > 0) {
          let pdfsHTML = `
            <div class="mb-3">
              <h6 class="text-primary">
                <i class="fas fa-book me-2"></i> ${result.pdfs.length} Materials Available
              </h6>
            </div>
            <div class="row g-4">
          `;
          
          result.pdfs.forEach((pdf, index) => {
            const uploadDate = new Date(pdf.created_at).toLocaleDateString('en-IN');
            const fileSizeMB = pdf.file_size ? (pdf.file_size / (1024 * 1024)).toFixed(2) : '0.00';
            
            pdfsHTML += `
            <div class="col-md-6 col-lg-4">
              <div class="pdf-card card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    <i class="fas fa-book me-1"></i>${pdf.course_code}
                  </small>
                  <span class="badge bg-secondary">PDF ${index + 1}</span>
                </div>
                <div class="card-body d-flex flex-column">
                  <div class="d-flex align-items-start mb-3">
                    <div class="me-3">
                      <i class="fas fa-file-pdf fa-3x text-danger"></i>
                    </div>
                    <div class="flex-grow-1">
                      <h6 class="mb-2">${pdf.pdf_title}</h6>
                      <div class="d-flex flex-wrap gap-2">
                        <small class="text-muted">
                          <i class="fas fa-calendar me-1"></i>${uploadDate}
                        </small>
                        <small class="text-muted">
                          <i class="fas fa-weight me-1"></i>${fileSizeMB} MB
                        </small>
                      </div>
                    </div>
                  </div>
                  
                  ${pdf.description ? `
                  <p class="card-text small text-muted mb-3">
                    ${pdf.description.substring(0, 80)}${pdf.description.length > 80 ? '...' : ''}
                  </p>
                  ` : ''}
                  
                  <div class="mt-auto pt-3 border-top">
                    <div class="d-grid gap-2">
                      <button class="btn btn-outline-success btn-sm" onclick="viewStudentPdf('${pdf.pdf_id}', '${pdf.pdf_title.replace(/'/g, "\\'")}')">
                        <i class="fas fa-eye me-1"></i> View PDF
                      </button>
                      <button class="btn btn-outline-primary btn-sm" onclick="downloadStudentPdf('${pdf.pdf_id}', '${pdf.pdf_title.replace(/'/g, "\\'")}')">
                        <i class="fas fa-download me-1"></i> Download
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            `;
          });
          
          pdfsHTML += '</div>';
          document.getElementById('pdfsContent').innerHTML = pdfsHTML;
          
        } else {
          document.getElementById('pdfsContent').innerHTML = `
            <div class="text-center py-5">
              <i class="fas fa-file-pdf fa-4x text-muted mb-3"></i>
              <h5 class="text-muted mb-2">No Study Materials Available</h5>
              <p class="text-muted">Study materials for ${student.course} will appear here once uploaded.</p>
            </div>
          `;
        }
        
      } catch (error) {
        console.error('Error loading study materials:', error);
        document.getElementById('pdfsContent').innerHTML = `
          <div class="alert alert-custom alert-warning">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Failed to load study materials</span>
          </div>
        `;
      }
    }

    // View PDF
    async function viewStudentPdf(pdfId, pdfTitle) {
      currentPdfId = pdfId;
      currentPdfTitle = pdfTitle || 'Study Material';
      currentPdfUrl = `${API_BASE_URL}/view-course-pdf/${pdfId}`;
      
      document.getElementById('pdfPreviewTitle').textContent = currentPdfTitle;
      
      const modal = document.getElementById('pdfPreviewModal');
      modal.classList.add('show');
      
      document.getElementById('pdfAlternativeView').style.display = 'none';
      document.getElementById('pdfViewerContainer').style.display = 'block';
      
      const iframe = document.getElementById('pdfViewer');
      const pdfUrl = `${API_BASE_URL}/view-course-pdf/${pdfId}`;
      
      iframe.src = pdfUrl;
      
      iframe.onload = function() {
        console.log('PDF loaded successfully');
      };
      
      iframe.onerror = function() {
        console.log('Failed to load PDF in iframe, showing alternative view');
        document.getElementById('pdfViewerContainer').style.display = 'none';
        document.getElementById('pdfAlternativeView').style.display = 'block';
      };
      
      setTimeout(function() {
        try {
          const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
          if (iframeDoc.body.innerHTML.includes('error') || iframeDoc.body.innerHTML.includes('502')) {
            document.getElementById('pdfViewerContainer').style.display = 'none';
            document.getElementById('pdfAlternativeView').style.display = 'block';
          }
        } catch (e) {
          console.log('Cannot check iframe content due to CORS');
        }
      }, 3000);
    }

    // Download PDF
    async function downloadStudentPdf(pdfId, pdfTitle) {
      currentPdfId = pdfId;
      currentPdfTitle = pdfTitle || 'Study Material';
      
      const downloadUrl = `${API_BASE_URL}/view-course-pdf/${pdfId}?download=true`;
      
      const originalText = event.currentTarget.innerHTML;
      event.currentTarget.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Downloading...';
      event.currentTarget.disabled = true;
      
      try {
        const link = document.createElement('a');
        link.href = downloadUrl;
        link.download = `${pdfTitle || 'document'}.pdf`;
        link.target = '_blank';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        setTimeout(() => {
          event.currentTarget.innerHTML = originalText;
          event.currentTarget.disabled = false;
        }, 2000);
        
      } catch (error) {
        console.error('Download error:', error);
        event.currentTarget.innerHTML = originalText;
        event.currentTarget.disabled = false;
        alert('Failed to download PDF. Please try again.');
      }
    }

    // Close PDF preview
    function closePdfPreview() {
      document.getElementById('pdfPreviewModal').classList.remove('show');
      document.getElementById('pdfViewer').src = '';
    }

    // Download current PDF from preview
    function downloadCurrentPdf() {
      if (currentPdfId) {
        const downloadUrl = `${API_BASE_URL}/view-course-pdf/${currentPdfId}?download=true`;
        window.open(downloadUrl, '_blank');
      }
    }

    // Load Syllabus
    async function loadSyllabus() {
      try {
        const profileResponse = await fetch(`${API_BASE_URL}/student-profile/${STUDENT_ID}`);
        const profileResult = await profileResponse.json();
        
        if (!profileResult.success || !profileResult.student) {
          document.getElementById('syllabusContent').innerHTML = `
            <div class="alert alert-custom alert-warning">
              <i class="fas fa-exclamation-triangle"></i>
              <span>Please complete your profile to view syllabus</span>
            </div>
          `;
          return;
        }
        
        const student = profileResult.student;
        const courseCode = student.course;
        
        const response = await fetch(`${API_BASE_URL}/syllabus/course/${courseCode}`);
        const result = await response.json();
        
        if (result.success && result.syllabus && result.syllabus.length > 0) {
          let syllabusHTML = '';
          
          result.syllabus.forEach((syllabus) => {
            if (syllabus.is_active) {
              syllabusHTML += `
                <div class="table-container mb-5">
                  <div class="table-title">
                    <i class="fas fa-book-open"></i>
                    <span>${syllabus.syllabus_title}</span>
                    <span class="ms-auto badge bg-info">Total: ${syllabus.total_duration} hours</span>
                  </div>
                  
                  ${syllabus.description ? `
                  <div class="alert alert-custom alert-info mb-0 rounded-0">
                    <i class="fas fa-info-circle"></i>
                    <span>${syllabus.description}</span>
                  </div>
                  ` : ''}
                  
                  <div class="table-responsive">
                    <table class="table table-custom">
                      <thead>
                        <tr>
                          <th width="5%" class="text-center">#</th>
                          <th width="30%">Subject</th>
                          <th width="15%" class="text-center">Duration</th>
                          <th width="50%">Topics Covered</th>
                        </tr>
                      </thead>
                      <tbody>
              `;
              
              if (syllabus.subjects && syllabus.subjects.length > 0) {
                syllabus.subjects.forEach((subject, idx) => {
                  const topics = subject.topics ? 
                    subject.topics.split(',').map(topic => 
                      `<span class="badge bg-light text-dark border me-1 mb-1">${topic.trim()}</span>`
                    ).join(' ') : 
                    '<span class="text-muted">Topics to be announced</span>';
                  
                  syllabusHTML += `
                    <tr>
                      <td class="text-center">${idx + 1}</td>
                      <td><strong>${subject.subject_name}</strong></td>
                      <td class="text-center">${subject.duration_hours} hrs</td>
                      <td>${topics}</td>
                    </tr>
                  `;
                });
              } else {
                syllabusHTML += `
                  <tr>
                    <td colspan="4" class="text-center text-muted py-4">
                      <i class="fas fa-book-reader me-2"></i>Subjects will be added soon
                    </td>
                  </tr>
                `;
              }
              
              syllabusHTML += `
                      </tbody>
                      <tfoot>
                        <tr class="table-active">
                          <td colspan="2" class="text-end fw-bold">Total Duration:</td>
                          <td class="text-center fw-bold">${syllabus.total_duration} hrs</td>
                          <td class="fw-bold">${syllabus.subjects?.length || 0} subjects</td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </div>
              `;
            }
          });
          
          if (syllabusHTML === '') {
            syllabusHTML = `
              <div class="alert alert-custom alert-info">
                <i class="fas fa-info-circle"></i>
                <span>No active syllabus found for ${courseCode}</span>
            </div>
            `;
          }
          
          document.getElementById('syllabusContent').innerHTML = syllabusHTML;
          
        } else {
          document.getElementById('syllabusContent').innerHTML = `
            <div class="text-center py-5">
              <i class="fas fa-book-open fa-4x text-muted mb-3"></i>
              <h5 class="text-muted mb-2">Syllabus Not Available Yet</h5>
              <p class="text-muted">The syllabus for ${courseCode} is being prepared.</p>
            </div>
          `;
        }
        
      } catch (error) {
        console.error('Error loading syllabus:', error);
        document.getElementById('syllabusContent').innerHTML = `
          <div class="alert alert-custom alert-danger">
            <i class="fas fa-exclamation-circle"></i>
            <span>Failed to load course syllabus</span>
          </div>
        `;
      }
    }

    // Load timetable
async function loadTimetable() {
  try {
    // First get student profile to get course
    const profileRes = await fetch(`${API_BASE_URL}/student-profile/${STUDENT_ID}`);
    if (!profileRes.ok) throw new Error('Failed to get student profile');
    
    const profileData = await profileRes.json();
    if (!profileData.success || !profileData.student) {
      throw new Error('Invalid student profile');
    }
    
    const course = profileData.student.course;
    if (!course) throw new Error('Course not found in profile');
    
    const response = await fetch(`${API_BASE_URL}/timetable/course/${encodeURIComponent(course)}`);
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const result = await response.json();
    
    if (result.success && result.timetable && result.timetable.length > 0) {
      let html = `
        <div class="table-responsive">
          <table class="table table-custom">
            <thead>
              <tr>
                <th>Day</th>
                <th>Time</th>
                <th>Subject</th>
                <th>Teacher</th>
                <th>Room</th>
              </tr>
            </thead>
            <tbody>
      `;
      
      result.timetable.forEach(item => {
        if (item.is_active) {
          // Convert 24-hour time to 12-hour AM/PM format
          const startTime12hr = convertTo12HourFormat(item.start_time);
          const endTime12hr = convertTo12HourFormat(item.end_time);
          
          html += `
            <tr>
              <td><strong>${item.day_of_week || 'N/A'}</strong></td>
              <td>
                <span class="badge bg-primary">${startTime12hr}</span>
                <span class="mx-1">-</span>
                <span class="badge bg-primary">${endTime12hr}</span>
              </td>
              <td><strong>${item.subject || 'N/A'}</strong></td>
              <td>${item.teacher_name || 'N/A'}</td>
              <td><span class="badge bg-secondary">${item.room_number || 'N/A'}</span></td>
            </tr>
          `;
        }
      });
      
      html += `
            </tbody>
          </table>
        </div>
      `;
      
      document.getElementById('timetableContent').innerHTML = html;
    } else {
      throw new Error(result.message || 'No timetable found');
    }
  } catch (error) {
    console.error('Error loading timetable:', error);
    document.getElementById('timetableContent').innerHTML = `
      <div class="alert alert-danger">
        <i class="fas fa-exclamation-triangle me-2"></i>
        Error loading timetable: ${error.message}
      </div>
    `;
  }
}

// Helper function to convert 24-hour time to 12-hour AM/PM format
function convertTo12HourFormat(time24) {
  if (!time24) return 'N/A';
  
  // Check if time is already in 12-hour format
  if (time24.includes('AM') || time24.includes('PM') || time24.includes('am') || time24.includes('pm')) {
    return time24;
  }
  
  try {
    // Split hours and minutes
    const [hours, minutes] = time24.split(':').map(Number);
    
    if (isNaN(hours) || isNaN(minutes)) {
      return time24;
    }
    
    // Determine AM/PM
    const period = hours >= 12 ? 'PM' : 'AM';
    
    // Convert to 12-hour format
    let hours12 = hours % 12;
    hours12 = hours12 === 0 ? 12 : hours12; // 0 should be 12 AM
    
    // Format minutes with leading zero if needed
    const minutesStr = minutes.toString().padStart(2, '0');
    
    return `${hours12}:${minutesStr} ${period}`;
  } catch (error) {
    console.error('Error converting time format:', error, 'for time:', time24);
    return time24;
  }
}

// Alternative: More robust time conversion function
function formatTimeTo12Hour(timeString) {
  if (!timeString) return '';
  
  // Remove any spaces
  timeString = timeString.trim();
  
  // If already in 12-hour format, return as is
  if (/^(0?[1-9]|1[0-2]):[0-5][0-9]\s?(AM|PM|am|pm)$/i.test(timeString)) {
    return timeString.toUpperCase().replace(/\s+/g, ' ');
  }
  
  // Try to parse as 24-hour format
  const timePattern = /^([0-1]?[0-9]|2[0-3]):([0-5][0-9])$/;
  const match = timeString.match(timePattern);
  
  if (match) {
    let hours = parseInt(match[1], 10);
    const minutes = match[2];
    const period = hours >= 12 ? 'PM' : 'AM';
    
    // Convert to 12-hour format
    hours = hours % 12;
    hours = hours === 0 ? 12 : hours;
    
    return `${hours}:${minutes} ${period}`;
  }
  
  // Return original if format is not recognized
  return timeString;
}

    // Load Results
    async function loadResults() {
      try {
        const response = await fetch(`${API_BASE_URL}/student-results/${STUDENT_ID}`);
        const result = await response.json();
        
        if (result.success && result.results && result.results.length > 0) {
          let tableHTML = `
            <div class="table-container">
              <div class="table-title">
                <i class="fas fa-chart-line"></i>
                <span>Academic Results</span>
              </div>
              <div class="table-responsive">
                <table class="table table-custom">
                  <thead>
                    <tr>
                      <th width="20%">Subject</th>
                      <th width="15%" class="text-center">Exam Type</th>
                      <th width="12%" class="text-center">Marks</th>
                      <th width="12%" class="text-center">Total</th>
                      <th width="15%" class="text-center">Percentage</th>
                      <th width="15%" class="text-center">Grade</th>
                      <th width="15%" class="text-center">Date</th>
                    </tr>
                  </thead>
                  <tbody>
          `;
          
          let totalMarks = 0;
          let totalMaxMarks = 0;
          
          result.results.forEach(item => {
            const percentage = ((item.marks_obtained / item.total_marks) * 100).toFixed(1);
            totalMarks += parseFloat(item.marks_obtained);
            totalMaxMarks += parseFloat(item.total_marks);
            
            tableHTML += `
              <tr>
                <td><strong>${item.subject}</strong></td>
                <td class="text-center">${item.exam_type}</td>
                <td class="text-center">${item.marks_obtained}</td>
                <td class="text-center">${item.total_marks}</td>
                <td class="text-center">${percentage}%</td>
                <td class="text-center">
                  <span class="badge badge-custom bg-${getGradeColor(item.grade)}">${item.grade}</span>
                </td>
                <td class="text-center">${item.exam_date}</td>
              </tr>
            `;
          });
          
          const overallPercentage = totalMaxMarks > 0 ? ((totalMarks / totalMaxMarks) * 100).toFixed(1) : 0;
          const overallGrade = calculateGrade(overallPercentage);
          
          tableHTML += `
                    </tbody>
                    <tfoot>
                      <tr class="table-active">
                        <td colspan="2" class="text-end fw-bold">Overall Performance:</td>
                        <td class="text-center fw-bold">${totalMarks}</td>
                        <td class="text-center fw-bold">${totalMaxMarks}</td>
                        <td class="text-center fw-bold">${overallPercentage}%</td>
                        <td class="text-center fw-bold">
                          <span class="badge badge-custom bg-${getGradeColor(overallGrade)}">${overallGrade}</span>
                        </td>
                        <td class="text-center fw-bold">${result.results.length} Exams</td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
          `;
          
          document.getElementById('resultsContent').innerHTML = tableHTML;
        } else {
          document.getElementById('resultsContent').innerHTML = `
            <div class="alert alert-custom alert-info">
              <i class="fas fa-info-circle"></i>
              <span>No results available yet</span>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error loading results:', error);
        document.getElementById('resultsContent').innerHTML = `
          <div class="alert alert-custom alert-danger">
            <i class="fas fa-exclamation-circle"></i>
            <span>Failed to load results</span>
          </div>
        `;
      }
    }

    // Calculate grade based on percentage
    function calculateGrade(percentage) {
      if (percentage >= 90) return 'A+';
      if (percentage >= 80) return 'A';
      if (percentage >= 70) return 'B+';
      if (percentage >= 60) return 'B';
      if (percentage >= 50) return 'C+';
      if (percentage >= 40) return 'C';
      return 'F';
    }

    // Load Fees with detailed history
    async function loadFees() {
      try {
        // Show loading
        document.getElementById('feesContent').innerHTML = `
          <div class="text-center py-5">
            <div class="spinner-custom mb-3"></div>
            <p class="text-muted">Loading fee details...</p>
          </div>
        `;
        
        // Use the detailed fee API
        const response = await fetch(`${API_BASE_URL}/student-fee-details/${STUDENT_ID}`);
        const result = await response.json();
        
        if (result.success) {
          const feeSummary = result.fee_summary;
          const feeHistory = result.fee_history;
          const studentInfo = result.student;
          
          const paidAmount = parseFloat(feeSummary.paid_amount) || 0;
          const totalAmount = parseFloat(feeSummary.fee_amount) || 0;
          const dueAmount = parseFloat(feeSummary.due_amount) || 0;
          const paymentStatus = feeSummary.fee_status || 'Pending';
          const totalRecords = result.total_records || 0;
          
          const paymentProgress = totalAmount > 0 ? (paidAmount / totalAmount) * 100 : 0;
          
          // Build fee history table
          let feeHistoryHTML = '';
          if (feeHistory.length > 0) {
            feeHistoryHTML = `
              <div class="table-container mt-4">
                <div class="table-title bg-primary">
                  <i class="fas fa-file-invoice-dollar"></i>
                  <span>Fee Payment History (${totalRecords} transactions)</span>
                </div>
                <div class="table-responsive">
                  <table class="table table-custom table-hover mb-0">
                    <thead>
                      <tr>
                        <th width="15%">Receipt No</th>
                        <th width="20%">Payment Date</th>
                        <th width="20%">Amount</th>
                        <th width="20%">Payment Mode</th>
                        <th width="15%">Status</th>
                        <th width="10%" class="text-center">Receipt</th>
                      </tr>
                    </thead>
                    <tbody>
            `;
            
            feeHistory.forEach((fee, index) => {
              // Format payment date
              let paymentDate = 'N/A';
              if (fee.payment_date) {
                try {
                  const dateObj = new Date(fee.payment_date);
                  paymentDate = dateObj.toLocaleDateString('en-IN', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                  });
                } catch (e) {
                  paymentDate = fee.payment_date;
                }
              }
              
              // Format amount
              const amount = parseFloat(fee.amount) || 0;
              
              // Payment mode badge
              let modeBadgeClass = 'bg-secondary';
              let modeIcon = 'fa-money-bill-wave';
              let modeText = fee.payment_mode || 'Cash';
              
              if (modeText.toLowerCase().includes('online')) {
                modeBadgeClass = 'bg-success';
                modeIcon = 'fa-globe';
              } else if (modeText.toLowerCase().includes('card')) {
                modeBadgeClass = 'bg-primary';
                modeIcon = 'fa-credit-card';
              } else if (modeText.toLowerCase().includes('cheque')) {
                modeBadgeClass = 'bg-info';
                modeIcon = 'fa-file-invoice';
              } else if (modeText.toLowerCase().includes('cash')) {
                modeBadgeClass = 'bg-dark';
                modeIcon = 'fa-money-bill-wave';
              }
              
              // Status badge
              const statusBadgeClass = fee.status === 'Completed' ? 'bg-success' : 
                                   fee.status === 'Pending' ? 'bg-warning' : 'bg-secondary';
              
              feeHistoryHTML += `
                <tr>
                  <td>
                    <div class="d-flex align-items-center">
                      <i class="fas fa-receipt text-primary me-2"></i>
                      <strong>${fee.receipt_no || `REC${index + 1}`}</strong>
                    </div>
                  </td>
                  <td>
                    <div class="d-flex align-items-center">
                      <i class="fas fa-calendar-day text-muted me-2"></i>
                      <span>${paymentDate}</span>
                    </div>
                  </td>
                  <td>
                    <div class="d-flex align-items-center">
                      <i class="fas fa-rupee-sign text-success me-2"></i>
                      <span class="fw-bold">${amount.toLocaleString('en-IN')}</span>
                    </div>
                  </td>
                  <td>
                    <span class="badge ${modeBadgeClass} px-3 py-2">
                      <i class="fas ${modeIcon} me-1"></i>
                      ${modeText}
                    </span>
                  </td>
                  <td>
                    <span class="badge ${statusBadgeClass} px-3 py-2">
                      <i class="fas fa-check-circle me-1"></i>
                      ${fee.status || 'Completed'}
                    </span>
                  </td>
                  <td class="text-center">
                    <button class="btn btn-sm btn-outline-primary px-3" onclick="downloadReceipt('${fee.receipt_no}', ${amount}, '${paymentDate}', '${modeText}')" title="Download Receipt">
                      <i class="fas fa-download"></i>
                    </button>
                  </td>
                </tr>
              `;
            });
            
            feeHistoryHTML += `
                    </tbody>
                  </table>
                </div>
                <div class="table-footer bg-light p-3 border-top">
                  <div class="row">
                    <div class="col-md-6">
                      <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        ${totalRecords} payment records found
                      </small>
                    </div>
                    <div class="col-md-6 text-end">
                      <strong class="text-primary">Total Paid: ${paidAmount.toLocaleString('en-IN')}</strong>
                    </div>
                  </div>
                </div>
              </div>
            `;
          } else {
            feeHistoryHTML = `
              <div class="text-center py-5">
                <div class="display-1 text-muted mb-3">
                  <i class="fas fa-receipt"></i>
                </div>
                <h4 class="text-muted mb-3">No Payment Records Yet</h4>
                <p class="text-muted mb-4">Your payment history will appear here after your first fee payment.</p>
                <div class="alert alert-info w-75 mx-auto">
                  <i class="fas fa-info-circle me-2"></i>
                  Please visit the institute office to make your first payment.
                </div>
              </div>
            `;
          }
          
          // Payment statistics card
          let paymentStatsHTML = '';
          if (feeHistory.length > 0) {
            // Count payment modes
            const modeCount = {};
            feeHistory.forEach(fee => {
              const mode = fee.payment_mode || 'Cash';
              modeCount[mode] = (modeCount[mode] || 0) + 1;
            });
            
            paymentStatsHTML = `
              <div class="card border-0 shadow-sm mt-4">
                <div class="card-header bg-white border-0">
                  <h6 class="mb-0">
                    <i class="fas fa-chart-pie text-primary me-2"></i>
                    Payment Analysis
                  </h6>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-8">
                      <h6 class="text-muted mb-3">Payment Methods Used</h6>
                      <div class="mb-4">
            `;
            
            Object.entries(modeCount).forEach(([mode, count]) => {
              const percentage = ((count / feeHistory.length) * 100).toFixed(0);
              paymentStatsHTML += `
                <div class="mb-3">
                  <div class="d-flex justify-content-between mb-1">
                    <span>${mode}</span>
                    <span class="text-muted">${count} (${percentage}%)</span>
                  </div>
                  <div class="progress" style="height: 8px;">
                    <div class="progress-bar" role="progressbar" 
                         style="width: ${percentage}%; background-color: ${getModeColor(mode)}">
                    </div>
                  </div>
                </div>
              `;
            });
            
            paymentStatsHTML += `
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="text-center p-4 bg-light rounded">
                        <div class="display-4 text-primary mb-2">${totalRecords}</div>
                        <div class="text-muted">Total Transactions</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            `;
          }
          
          // Office payment information card
          const officePaymentHTML = `
            <div class="card border-primary border-2 mt-4">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                  <i class="fas fa-building me-2"></i>
                  Institute Payment Information
                </h5>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <h6 class="text-primary mb-3">
                      <i class="fas fa-map-marker-alt me-2"></i>
                      Visit Office For Payment
                    </h6>
                    <div class="mb-3">
                      <p class="mb-1">
                        <strong>Office Hours:</strong><br>
                        Monday - Friday: 9:00 AM - 6:00 PM<br>
                        Saturday: 9:00 AM - 2:00 PM<br>
                        Sunday: Closed
                      </p>
                    </div>
                    <div class="mb-3">
                      <p class="mb-1">
                        <strong>Accepted Payment Methods:</strong><br>
                         Cash<br>
                         Cheque (Payable to AACEM Institute)<br>
                         Demand Draft<br>
                         Bank Transfer
                      </p>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <h6 class="text-primary mb-3">
                      <i class="fas fa-phone-alt me-2"></i>
                      Contact Information
                    </h6>
                    <div class="mb-3">
                      <p class="mb-1">
                        <strong>Institute Address:</strong><br>
                        AACEM Institute<br>
                        123 Education Street<br>
                        Knowledge City, Mumbai - 400001
                      </p>
                    </div>
                    <div class="mb-3">
                      <p class="mb-1">
                        <strong>Contact Details:</strong><br>
                        <i class="fas fa-phone me-2 text-muted"></i> +91 9876543210<br>
                        <i class="fas fa-envelope me-2 text-muted"></i> accounts@aacem.edu.in<br>
                        <i class="fas fa-globe me-2 text-muted"></i> www.aacem.edu.in
                      </p>
                    </div>
                  </div>
                </div>
                
                ${dueAmount > 0 ? `
                <div class="alert alert-warning mt-3">
                  <div class="d-flex align-items-center">
                    <i class="fas fa-exclamation-triangle fa-2x me-3 text-warning"></i>
                    <div>
                      <h6 class="mb-1">Payment Due: ${dueAmount.toLocaleString('en-IN')}</h6>
                      <p class="mb-0">Please visit the institute office to clear your pending dues at the earliest.</p>
                    </div>
                  </div>
                </div>
                ` : `
                <div class="alert alert-success mt-3">
                  <div class="d-flex align-items-center">
                    <i class="fas fa-check-circle fa-2x me-3 text-success"></i>
                    <div>
                      <h6 class="mb-1">All Payments Complete!</h6>
                      <p class="mb-0">Thank you for completing all your fee payments. No dues remaining.</p>
                    </div>
                  </div>
                </div>
                `}
              </div>
            </div>
          `;
          
          // Progress bar with colors
          let progressBarColor = '';
          if (paymentProgress >= 100) {
            progressBarColor = 'bg-success';
          } else if (paymentProgress >= 75) {
            progressBarColor = 'bg-info';
          } else if (paymentProgress >= 50) {
            progressBarColor = 'bg-primary';
          } else if (paymentProgress >= 25) {
            progressBarColor = 'bg-warning';
          } else {
            progressBarColor = 'bg-danger';
          }
          
          // Main HTML
          document.getElementById('feesContent').innerHTML = `
            <!-- Student Info Header -->
            <div class="card border-0 shadow-sm mb-4">
              <div class="card-body">
                <div class="row align-items-center">
                  <div class="col-md-8">
                    <h4 class="text-primary mb-1">
                      <i class="fas fa-user-graduate me-2"></i>${studentInfo.name}
                    </h4>
                    <p class="text-muted mb-2">
                      <i class="fas fa-book me-2"></i>${studentInfo.course_name || studentInfo.course}
                      | <i class="fas fa-id-card me-2"></i>${STUDENT_ID}
                      | <i class="fas fa-calendar-day me-2"></i>Admitted: ${studentInfo.join_date || 'N/A'}
                    </p>
                  </div>
                  <div class="col-md-4 text-end">
                    <div class="h3 mb-0 text-${paymentStatus === 'Paid' ? 'success' : paymentStatus === 'Partial' ? 'warning' : 'danger'}">
                      ${paymentStatus}
                    </div>
                    <small class="text-muted">Fee Status</small>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Fee Summary Cards -->
            <div class="row g-4 mb-4">
              <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100">
                  <div class="card-body text-center p-4">
                    <div class="text-primary mb-3">
                      <i class="fas fa-file-invoice-dollar fa-3x"></i>
                    </div>
                    <h5 class="card-title text-muted mb-2">Total Course Fee</h5>
                    <h2 class="card-text text-primary">${totalAmount.toLocaleString('en-IN')}</h2>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100">
                  <div class="card-body text-center p-4">
                    <div class="text-success mb-3">
                      <i class="fas fa-check-circle fa-3x"></i>
                    </div>
                    <h5 class="card-title text-muted mb-2">Total Paid</h5>
                    <h2 class="card-text text-success">${paidAmount.toLocaleString('en-IN')}</h2>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100">
                  <div class="card-body text-center p-4">
                    <div class="${dueAmount > 0 ? 'text-danger' : 'text-secondary'} mb-3">
                      <i class="fas fa-balance-scale fa-3x"></i>
                    </div>
                    <h5 class="card-title text-muted mb-2">Balance Due</h5>
                    <h2 class="card-text ${dueAmount > 0 ? 'text-danger' : 'text-secondary'}">${dueAmount.toLocaleString('en-IN')}</h2>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100">
                  <div class="card-body text-center p-4">
                    <div class="text-info mb-3">
                      <i class="fas fa-percentage fa-3x"></i>
                    </div>
                    <h5 class="card-title text-muted mb-2">Payment Progress</h5>
                    <h2 class="card-text text-info">${paymentProgress.toFixed(1)}%</h2>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Progress Bar -->
            <div class="card border-0 shadow-sm mb-4">
              <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                  <h6 class="card-title text-muted mb-0">
                    <i class="fas fa-chart-line me-2"></i>Payment Completion
                  </h6>
                  <span class="badge ${paymentProgress === 100 ? 'bg-success' : 'bg-primary'}">
                    ${paymentProgress.toFixed(1)}%
                  </span>
                </div>
                <div class="progress" style="height: 15px;">
                  <div class="progress-bar ${progressBarColor} progress-bar-striped progress-bar-animated" 
                       role="progressbar" 
                       style="width: ${paymentProgress}%"
                       aria-valuenow="${paymentProgress}" 
                       aria-valuemin="0" 
                       aria-valuemax="100">
                  </div>
                </div>
                <div class="d-flex justify-content-between mt-2">
                  <small class="text-muted">0</small>
                  <small class="text-muted">${totalAmount.toLocaleString('en-IN')}</small>
                </div>
              </div>
            </div>
            
            <!-- Payment History -->
            ${feeHistoryHTML}
            
            <!-- Payment Statistics -->
            ${paymentStatsHTML}
            
            <!-- Office Payment Information -->
            ${officePaymentHTML}
            
            <!-- Important Notice -->
            <div class="alert alert-primary mt-4">
              <div class="d-flex align-items-center">
                <i class="fas fa-exclamation-circle fa-2x me-3"></i>
                <div>
                  <h6 class="mb-1">Important Notice</h6>
                  <p class="mb-0">
                    All fee payments must be made directly at the institute office. 
                    Please bring your student ID card and previous receipts (if any) when making payments.
                    Online payment facility will be available soon.
                  </p>
                </div>
              </div>
            </div>
          `;
          
        } else {
          document.getElementById('feesContent').innerHTML = `
            <div class="alert alert-warning">
              <div class="d-flex align-items-center">
                <i class="fas fa-exclamation-triangle fa-2x me-3"></i>
                <div>
                  <h5 class="mb-1">Fee Details Not Available</h5>
                  <p class="mb-0">${result.message || 'Unable to load your fee information at the moment.'}</p>
                </div>
              </div>
              <div class="mt-3">
                <button class="btn btn-primary" onclick="loadFees()">
                  <i class="fas fa-redo me-2"></i>Try Again
                </button>
              </div>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error loading fees:', error);
        document.getElementById('feesContent').innerHTML = `
          <div class="alert alert-danger">
            <div class="d-flex align-items-center">
              <i class="fas fa-exclamation-circle fa-2x me-3"></i>
              <div>
                <h5 class="mb-1">Connection Error</h5>
                <p class="mb-0">Unable to connect to the server. Please check your internet connection.</p>
                <small class="text-muted">Error: ${error.message}</small>
              </div>
            </div>
            <div class="mt-3">
              <button class="btn btn-outline-primary" onclick="loadFees()">
                <i class="fas fa-redo me-2"></i>Retry
              </button>
              <button class="btn btn-primary ms-2" onclick="showSection('profile')">
                <i class="fas fa-user me-2"></i>Go to Profile
              </button>
            </div>
          </div>
        `;
      }
    }

    // Load Notices
    async function loadNotices() {
      try {
        const response = await fetch(`${API_BASE_URL}/student-notices`);
        const result = await response.json();
        
        if (result.success && result.notices && result.notices.length > 0) {
          let noticesHTML = '<div class="list-group">';
          
          result.notices.forEach(notice => {
            const noticeDate = new Date(notice.created_at).toLocaleDateString('en-IN');
            const priorityClass = notice.priority === 'high' ? 'border-danger' : 
                                notice.priority === 'medium' ? 'border-warning' : 'border-secondary';
            
            noticesHTML += `
            <div class="list-group-item ${priorityClass} border-start border-4 mb-3">
              <div class="d-flex w-100 justify-content-between align-items-start mb-2">
                <h6 class="mb-0">${notice.title}</h6>
                <small class="text-muted">${noticeDate}</small>
              </div>
              <p class="mb-1">${notice.message}</p>
              ${notice.priority === 'high' ? '<small class="text-danger"><i class="fas fa-exclamation-circle me-1"></i>Important Notice</small>' : ''}
            </div>
            `;
          });
          
          noticesHTML += '</div>';
          document.getElementById('noticesContent').innerHTML = noticesHTML;
        } else {
          document.getElementById('noticesContent').innerHTML = `
            <div class="alert alert-custom alert-info">
              <i class="fas fa-info-circle"></i>
              <span>No notices at the moment</span>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error loading notices:', error);
        document.getElementById('noticesContent').innerHTML = `
          <div class="alert alert-custom alert-danger">
            <i class="fas fa-exclamation-circle"></i>
            <span>Failed to load notices</span>
          </div>
        `;
      }
    }

    // Helper function for mode colors
    function getModeColor(mode) {
      switch(mode.toLowerCase()) {
        case 'cash': return '#343a40';
        case 'online': return '#28a745';
        case 'card': return '#007bff';
        case 'cheque': return '#17a2b8';
        default: return '#6c757d';
      }
    }

    // Enhanced receipt download function
    // Enhanced receipt download function
    async function downloadReceipt(receiptNo, amount, paymentDate, paymentMode) {
      // Get student info
      const student = await fetch(`${API_BASE_URL}/student-profile/${STUDENT_ID}`)
        .then(res => res.json())
        .then(data => data.student)
        .catch(() => null);
      
      const receiptWindow = window.open('', '_blank');
      const today = new Date().toLocaleDateString('en-IN', {
        day: '2-digit',
        month: 'long',
        year: 'numeric'
      });
      
      const formattedDate = paymentDate ? 
        new Date(paymentDate).toLocaleDateString('en-IN', {
          day: '2-digit',
          month: 'long',
          year: 'numeric'
        }) : today;
      
      // Amount to words function -     
      function amountToWords(num) {
        const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
        const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
        const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
        
        if (num === 0) return 'Zero';
        
        let words = '';
        
        if (Math.floor(num / 10000000) > 0) {
          words += amountToWords(Math.floor(num / 10000000)) + ' Crore ';
          num %= 10000000;
        }
        
        if (Math.floor(num / 100000) > 0) {
          words += amountToWords(Math.floor(num / 100000)) + ' Lakh ';
          num %= 100000;
        }
        
        if (Math.floor(num / 1000) > 0) {
          words += amountToWords(Math.floor(num / 1000)) + ' Thousand ';
          num %= 1000;
        }
        
        if (Math.floor(num / 100) > 0) {
          words += amountToWords(Math.floor(num / 100)) + ' Hundred ';
          num %= 100;
        }
        
        if (num > 0) {
          if (words !== '') words += 'and ';
          
          if (num < 10) {
            words += ones[num];
          } else if (num < 20) {
            words += teens[num - 10];
          } else {
            words += tens[Math.floor(num / 10)];
            if (num % 10 > 0) {
              words += ' ' + ones[num % 10];
            }
          }
        }
        
        return words.trim();
      }
      
      // Amount in words calculate 
      const amountInWords = amount ? amountToWords(amount) : 'Zero';
      
      receiptWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Receipt ${receiptNo}</title>
          <style>
            @media print {
              body { margin: 0; padding: 20px; }
              .no-print { display: none !important; }
            }
            body { 
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              padding: 30px;
              background: #f8f9fa;
              color: #333;
            }
            .receipt-container {
              max-width: 800px;
              margin: 0 auto;
              background: white;
              border: 2px solid #2d6b6b;
              border-radius: 10px;
              padding: 40px;
              box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            }
            .header {
              text-align: center;
              border-bottom: 3px solid #2d6b6b;
              padding-bottom: 20px;
              margin-bottom: 30px;
            }
            .header h1 {
              color: #2d6b6b;
              margin: 0 0 10px 0;
              font-size: 28px;
            }
            .header p {
              color: #666;
              margin: 0;
              font-size: 14px;
            }
            .receipt-title {
              text-align: center;
              font-size: 24px;
              color: #2d6b6b;
              margin: 30px 0;
              font-weight: bold;
            }
            .receipt-details {
              margin: 30px 0;
            }
            .detail-row {
              display: flex;
              justify-content: space-between;
              padding: 12px 0;
              border-bottom: 1px solid #eee;
            }
            .detail-row:last-child {
              border-bottom: none;
            }
            .detail-label {
              font-weight: 600;
              color: #555;
              width: 40%;
            }
            .detail-value {
              width: 60%;
              text-align: right;
              font-weight: 500;
            }
            .amount-box {
              background: #f8f9fa;
              border: 2px dashed #2d6b6b;
              border-radius: 8px;
              padding: 25px;
              text-align: center;
              margin: 30px 0;
            }
            .amount-in-words {
              font-style: italic;
              color: #666;
              margin-top: 10px;
              font-size: 14px;
            }
            .footer {
              margin-top: 40px;
              padding-top: 20px;
              border-top: 2px solid #eee;
              text-align: center;
              color: #666;
              font-size: 12px;
            }
            .stamp {
              float: right;
              margin-top: 30px;
              padding: 15px;
              border: 2px solid #28a745;
              border-radius: 5px;
              text-align: center;
              transform: rotate(5deg);
            }
            .stamp span {
              display: block;
              font-weight: bold;
              color: #28a745;
              font-size: 18px;
            }
            .action-buttons {
              margin-top: 30px;
              text-align: center;
            }
            .btn {
              padding: 12px 30px;
              border: none;
              border-radius: 5px;
              cursor: pointer;
              font-size: 16px;
              font-weight: 600;
              margin: 0 10px;
              transition: all 0.3s;
            }
            .btn-print {
              background: #2d6b6b;
              color: white;
            }
            .btn-print:hover {
              background: #1d4b4b;
            }
            .btn-close {
              background: #6c757d;
              color: white;
            }
            .btn-close:hover {
              background: #545b62;
            }
            .watermark {
              position: fixed;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%) rotate(-45deg);
              font-size: 120px;
              color: rgba(45, 107, 107, 0.1);
              z-index: -1;
              font-weight: bold;
              white-space: nowrap;
            }
          </style>
        </head>
        <body>
          <div class="watermark">AACEM INSTITUTE</div>
          <div class="receipt-container">
            <div class="header">
              <h1>AACEM INSTITUTE</h1>
              <p>123 Education Street, Knowledge City, Mumbai - 400001</p>
              <p>Phone: +91 9876543210 | Email: accounts@aacem.edu.in | Website: www.aacem.edu.in</p>
            </div>
            
            <div class="receipt-title">FEE PAYMENT RECEIPT</div>
            
            <div class="receipt-details">
              <div class="detail-row">
                <div class="detail-label">Receipt Number:</div>
                <div class="detail-value"><strong>${receiptNo}</strong></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Student Name:</div>
                <div class="detail-value"><strong>${student?.name || STUDENT_ID}</strong></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Student ID:</div>
                <div class="detail-value">${STUDENT_ID}</div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Course:</div>
                <div class="detail-value">${student?.course || 'N/A'}</div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Payment Date:</div>
                <div class="detail-value">${formattedDate}</div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Payment Mode:</div>
                <div class="detail-value">${paymentMode}</div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Receipt Generated On:</div>
                <div class="detail-value">${today}</div>
              </div>
            </div>
            
            <div class="amount-box">
              <div style="font-size: 36px; color: #2d6b6b; font-weight: bold;">
                 ${amount ? amount.toLocaleString('en-IN') : '0'}
              </div>
              <div class="amount-in-words">
                Amount in words: ${amountInWords} rupees only
              </div>
            </div>
            
            <div class="stamp">
              <span>PAID</span>
              <div style="font-size: 12px; margin-top: 5px;">AACEM Institute</div>
            </div>
            
            <div class="footer">
              <p>This is a computer generated receipt. No signature required.</p>
              <p>Please keep this receipt for future reference.</p>
              <p>For any queries, contact the accounts department.</p>
              <br>
              <p>Thank you for your payment!</p>
            </div>
            
            <div class="action-buttons no-print">
              <button class="btn btn-print" onclick="window.print()">
                <i class="fas fa-print me-2"></i>Print Receipt
              </button>
              <button class="btn btn-close" onclick="window.close()">
                <i class="fas fa-times me-2"></i>Close Window
              </button>
            </div>
          </div>
          
          <script>
            // Auto-print option
            setTimeout(() => {
              if (confirm('Do you want to print this receipt?')) {
                window.print();
              }
            }, 1000);
          
        </body>
        </html>
      `);
      receiptWindow.document.close();
    }

    // Pay fees function (update this)
    function payFees() {
      alert('Please visit the institute office for all fee payments.\n\nOffice Hours:\nMonday-Friday: 9:00 AM - 6:00 PM\nSaturday: 9:00 AM - 2:00 PM\n\nContact: +91 9876543210\nEmail: accounts@aacem.edu.in\n\nPlease bring your student ID card and previous receipts (if any).');
    }

    // Helper functions
    function getGradeColor(grade) {
      switch(grade) {
        case 'A+': case 'A': return 'success';
        case 'B+': case 'B': return 'info';
        case 'C+': case 'C': return 'warning';
        default: return 'danger';
      }
    }

    function getFeeStatusColor(status) {
      switch(status) {
        case 'Paid': return 'success';
        case 'Partial': return 'warning';
        case 'Pending': return 'danger';
        default: return 'secondary';
      }
    }
  </script>
</body>
</html>

